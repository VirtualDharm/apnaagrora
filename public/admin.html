
  <!doctype html>
  <html>
  <head>
    <meta charset="utf-8" />
    <title>Casting API Admin</title>
    <style>
      body { font-family: Arial, Helvetica, sans-serif; max-width: 900px; margin: 20px; }
      input, button, textarea { padding: 8px; margin: 4px 0; width: 100%; }
      .row { display:flex; gap:10px; }
      .col { flex:1; }
      pre { background:#f4f4f4; padding:10px; overflow:auto; }
      .small { font-size:0.9em; color:#666; }
    </style>
  </head>
  <body>
    <h2>Casting API â€” Admin</h2>

    <section>
      <h3>Create room</h3>
      <input id="ownerId" placeholder="ownerId (optional)" />
      <input id="ttlSeconds" placeholder="ttlSeconds (3600)" />
      <input id="meta" placeholder='metadata JSON ({"topic":"demo"})' />
      <button id="createRoomBtn">Create Room</button>
      <pre id="createRoomResult"></pre>
    </section>

    <section>
      <h3>List rooms</h3>
      <button id="listRoomsBtn">Refresh Rooms</button>
      <pre id="roomsList"></pre>
    </section>

    <section>
      <h3>Create Invite</h3>
      <input id="inviteRoomId" placeholder="roomId" />
      <input id="inviteeId" placeholder="inviteeId (optional)" />
      <input id="inviteTtl" placeholder="ttlSeconds (900)" />
      <button id="inviteBtn">Create Invite</button>
      <pre id="inviteResult"></pre>
    </section>

    <section>
      <h3>Generate Token (explicit)</h3>
      <input id="tokenRoomId" placeholder="roomId" />
      <input id="tokenUserId" placeholder="userId" />
      <input id="tokenTtl" placeholder="ttlSeconds (3600)" />
      <button id="tokenBtn">Generate Token</button>
      <pre id="tokenResult"></pre>
    </section>

    <section>
      <h3>Revoke Token (by jti)</h3>
      <input id="revokeJti" placeholder="jti" />
      <button id="revokeBtn">Revoke</button>
      <pre id="revokeResult"></pre>
    </section>

    <script>
      const base = location.origin;

      document.getElementById("createRoomBtn").onclick = async () => {
        const ownerId = document.getElementById("ownerId").value || undefined;
        const ttlSeconds = parseInt(document.getElementById("ttlSeconds").value) || undefined;
        let metadata = {};
        try {
          const txt = document.getElementById("meta").value;
          if (txt) metadata = JSON.parse(txt);
        } catch (e) { alert("invalid JSON metadata"); return; }
        const res = await fetch(base + "/rooms", { method: "POST", headers: {'content-type':'application/json'}, body: JSON.stringify({ ownerId, ttlSeconds, metadata })});
        const j = await res.json();
        document.getElementById("createRoomResult").textContent = JSON.stringify(j, null, 2);
      };

      document.getElementById("listRoomsBtn").onclick = async () => {
        const res = await fetch(base + "/rooms");
        document.getElementById("roomsList").textContent = JSON.stringify(await res.json(), null, 2);
      };

      document.getElementById("inviteBtn").onclick = async () => {
        const roomId = document.getElementById("inviteRoomId").value;
        const inviteeId = document.getElementById("inviteeId").value || undefined;
        const ttlSeconds = parseInt(document.getElementById("inviteTtl").value) || undefined;
        if (!roomId) return alert("roomId required");
        const res = await fetch(base + "/rooms/" + roomId + "/invite", { method: "POST", headers: {'content-type':'application/json'}, body: JSON.stringify({ inviteeId, ttlSeconds })});
        document.getElementById("inviteResult").textContent = JSON.stringify(await res.json(), null, 2);
      };

      document.getElementById("tokenBtn").onclick = async () => {
        const roomId = document.getElementById("tokenRoomId").value;
        const userId = document.getElementById("tokenUserId").value;
        const ttl = parseInt(document.getElementById("tokenTtl").value) || undefined;
        if (!roomId || !userId) return alert("roomId and userId required");
        const res = await fetch(base + "/token", { method: "POST", headers: {'content-type':'application/json'}, body: JSON.stringify({ roomId, userId, ttlSeconds: ttl })});
        document.getElementById("tokenResult").textContent = JSON.stringify(await res.json(), null, 2);
      };

      document.getElementById("revokeBtn").onclick = async () => {
        const jti = document.getElementById("revokeJti").value;
        if (!jti) return alert("jti required");
        const res = await fetch(base + "/token/" + jti + "/revoke", { method: "POST" });
        document.getElementById("revokeResult").textContent = JSON.stringify(await res.json(), null, 2);
      };

      // initial fetch
      document.getElementById("listRoomsBtn").click();
    </script>
  </body>
  </html>
  